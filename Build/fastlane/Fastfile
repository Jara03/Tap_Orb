default_platform(:ios)

platform :ios do
  desc "Build and upload to TestFlight (CI)"
  lane :beta do

    # ğŸ” Signing via fastlane match using App Store Connect API Key
    match(
    type: "appstore",
    readonly: true,
    skip_certificate_verification: true,
    api_key: app_store_connect_api_key(
    key_id: ENV["APP_STORE_CONNECT_API_KEY_ID"],
    issuer_id: ENV["APP_STORE_CONNECT_ISSUER_ID"],
    key_content: ENV["APP_STORE_CONNECT_PRIVATE_KEY"],
    is_key_content_base64: false
  )
)

    # ğŸ— Build the Xcode project generated by Unity
    build_app(
      scheme: "Unity-iPhone",
      export_method: "app-store",
      clean: true
    )

    # ğŸš€ Upload to TestFlight
    upload_to_testflight(
      skip_waiting_for_build_processing: true
    )
  end
end
